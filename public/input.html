<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è©³ç´°æƒ…å ±å…¥åŠ› - ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ </title>
  <link rel="stylesheet" href="/css/common.css">
  <style>
    /* å…¥åŠ›ç”»é¢å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
    .selected-cards-summary {
      background: linear-gradient(135deg, #f0f4ff 0%, #e8f0ff 100%);
      border: 2px solid #667eea;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 30px;
    }
    
    .selected-cards-summary h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 18px;
    }
    
    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .card-tag {
      background: white;
      border: 1px solid #667eea;
      color: #667eea;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 5px;
    }
    
    .input-section {
      margin-bottom: 30px;
    }
    
    .input-group {
      margin-bottom: 25px;
    }
    
    .input-label {
      display: block;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
      font-size: 16px;
    }
    
    .input-label .required {
      color: #e74c3c;
      margin-left: 5px;
    }
    
    .input-description {
      color: #666;
      font-size: 14px;
      margin-bottom: 10px;
    }
    
    .input-field {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s;
      font-family: inherit;
    }
    
    .input-field:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .input-field.error {
      border-color: #e74c3c;
      background: #fff5f5;
    }
    
    textarea.input-field {
      min-height: 120px;
      resize: vertical;
    }
    
    .help-text {
      color: #888;
      font-size: 13px;
      margin-top: 5px;
    }
    
    .error-message {
      color: #e74c3c;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }
    
    .error-message.show {
      display: block;
    }
    
    .char-counter {
      text-align: right;
      font-size: 13px;
      color: #888;
      margin-top: 5px;
    }
    
    .char-counter.warning {
      color: #f39c12;
    }
    
    .char-counter.error {
      color: #e74c3c;
    }
    
    .checkbox-group,
    .radio-group {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    
    .checkbox-item,
    .radio-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .checkbox-item input,
    .radio-item input {
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    
    .checkbox-item label,
    .radio-item label {
      cursor: pointer;
      font-size: 15px;
    }
    
    .action-buttons {
      display: flex;
      gap: 15px;
      margin-top: 40px;
      justify-content: center;
    }
    
    .progress-bar {
      background: #e0e0e0;
      border-radius: 10px;
      height: 8px;
      overflow: hidden;
      margin: 20px 0;
    }
    
    .progress-bar-fill {
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      height: 100%;
      width: 50%;
      transition: width 0.3s;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
      <h1 id="gameName">è©³ç´°æƒ…å ±ã®å…¥åŠ›</h1>
      <div class="header-nav">
        <span class="status">ã‚¹ãƒ†ãƒƒãƒ— 2/4</span>
        <button onclick="logout()" class="btn btn-secondary" style="padding: 8px 20px; font-size: 14px;">
          ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        </button>
      </div>
    </div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="card">
      <div id="loadingMessage" class="loading">
        <div class="spinner"></div>
        <p>ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
      </div>
      
      <div id="mainContent" style="display: none;">
        <!-- é€²æ—ãƒãƒ¼ -->
        <div class="progress-bar">
          <div class="progress-bar-fill"></div>
        </div>
        
        <!-- é¸æŠã—ãŸã‚«ãƒ¼ãƒ‰ã®ã‚µãƒãƒªãƒ¼ -->
        <div class="selected-cards-summary">
          <h3>ğŸ“‹ é¸æŠã—ãŸã‚«ãƒ¼ãƒ‰</h3>
          <div id="selectedCardsSummary" class="card-tags"></div>
        </div>
        
        <hr style="margin: 30px 0; border: none; border-top: 1px solid #e0e0e0;">
        
        <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="input-section">
          <h2 style="color: #667eea; margin-bottom: 20px;">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è©³ç´°æƒ…å ±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
          <p style="color: #666; margin-bottom: 30px;">
            é¸æŠã—ãŸã‚«ãƒ¼ãƒ‰ã‚’ã‚‚ã¨ã«ã€ã‚ãªãŸã®ãƒãƒ¼ãƒ ç‹¬è‡ªã®æƒ…å ±ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šå…·ä½“çš„ã§å®Ÿè·µçš„ãªææ¡ˆæ›¸ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚
          </p>
          
          <form id="inputForm">
            <!-- å‹•çš„ã«ç”Ÿæˆ -->
            <div id="inputFieldsContainer"></div>
          </form>
        </div>
        
        <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
        <div class="action-buttons">
          <button onclick="goBack()" class="btn btn-secondary">
            â† æˆ»ã‚‹
          </button>
          <button onclick="clearForm()" class="btn btn-secondary">
            å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
          </button>
          <button id="nextButton" onclick="goToNext()" class="btn">
            æˆæœç‰©ã‚’ç”Ÿæˆ â†’
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <script src="/js/core/InputManager.js"></script>
  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
    let gameData = null;
    let selectedCards = null;
    let inputManager = null;
    
    // èªè¨¼ãƒã‚§ãƒƒã‚¯
    document.addEventListener('DOMContentLoaded', async () => {
      const sessionKey = sessionStorage.getItem('card_game_access_key');
      if (!sessionKey) {
        window.location.href = '/access-key.html';
        return;
      }
      
      // é¸æŠã•ã‚ŒãŸã‚«ãƒ¼ãƒ‰ã‚’å–å¾—
      const selectedCardsJson = sessionStorage.getItem('selected_cards');
      if (!selectedCardsJson) {
        alert('ã‚«ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\nã‚«ãƒ¼ãƒ‰é¸æŠç”»é¢ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚');
        window.location.href = '/game-selection.html';
        return;
      }
      
      selectedCards = JSON.parse(selectedCardsJson);
      
      // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¾ãŸã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰ã‚²ãƒ¼ãƒ IDã‚’å–å¾—
      const urlParams = new URLSearchParams(window.location.search);
      const gameId = urlParams.get('id') || sessionStorage.getItem('currentGameId') || 'city-dx';
      
      // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
      await loadGameData(gameId);
    });
    
    // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    async function loadGameData(gameId) {
      try {
        const response = await fetch(`/data/games/${gameId}.json`);
        if (!response.ok) throw new Error('ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
        
        gameData = await response.json();
        
        // InputManagerã‚’åˆæœŸåŒ–
        inputManager = new InputManager(gameData);
        
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°å¾©å…ƒ
        const savedInputJson = sessionStorage.getItem('user_inputs');
        if (savedInputJson) {
          const savedInput = JSON.parse(savedInputJson);
          inputManager.fromJSON(savedInput);
        }
        
        // ç”»é¢ã‚’åˆæœŸåŒ–
        initializeUI();
        renderSelectedCards();
        renderInputFields();
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°éè¡¨ç¤ºã€ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤º
        document.getElementById('loadingMessage').style.display = 'none';
        document.getElementById('mainContent').style.display = 'block';
        
      } catch (error) {
        console.error('ã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\n\n' + error.message);
        window.location.href = '/game-selection.html';
      }
    }
    
    // UIåˆæœŸåŒ–
    function initializeUI() {
      document.getElementById('gameName').textContent = gameData.gameName;
    }
    
    // é¸æŠã—ãŸã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
    function renderSelectedCards() {
      const container = document.getElementById('selectedCardsSummary');
      container.innerHTML = '';
      
      // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«æ•´ç†
      Object.entries(selectedCards).forEach(([categoryId, cardIds]) => {
        cardIds.forEach(cardId => {
          const card = gameData.cards.find(c => c.cardId === cardId);
          if (card) {
            const tag = document.createElement('div');
            tag.className = 'card-tag';
            tag.innerHTML = `${card.icon || 'ğŸ“„'} ${card.cardName}`;
            container.appendChild(tag);
          }
        });
      });
    }
    
    // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å‹•çš„ç”Ÿæˆ
    function renderInputFields() {
      const container = document.getElementById('inputFieldsContainer');
      container.innerHTML = '';
      
      const fields = inputManager.getInputFields();
      
      fields.forEach(field => {
        const fieldGroup = document.createElement('div');
        fieldGroup.className = 'input-group';
        fieldGroup.id = `group-${field.fieldId}`;
        
        // ãƒ©ãƒ™ãƒ«
        const label = document.createElement('label');
        label.className = 'input-label';
        label.htmlFor = field.fieldId;
        label.innerHTML = field.fieldName;
        if (field.required) {
          label.innerHTML += '<span class="required">*</span>';
        }
        fieldGroup.appendChild(label);
        
        // èª¬æ˜
        if (field.description) {
          const desc = document.createElement('div');
          desc.className = 'input-description';
          desc.textContent = field.description;
          fieldGroup.appendChild(desc);
        }
        
        // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—ã”ã¨ã«åˆ†å²
        let inputElement;
        
        switch (field.fieldType) {
          case 'text':
          case 'number':
            inputElement = createTextOrNumberInput(field);
            break;
          case 'textarea':
            inputElement = createTextareaInput(field);
            break;
          case 'select':
            inputElement = createSelectInput(field);
            break;
          case 'checkbox':
            inputElement = createCheckboxInput(field);
            break;
          case 'radio':
            inputElement = createRadioInput(field);
            break;
        }
        
        if (inputElement) {
          fieldGroup.appendChild(inputElement);
        }
        
        // ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆ
        if (field.helpText) {
          const helpText = document.createElement('div');
          helpText.className = 'help-text';
          helpText.textContent = field.helpText;
          fieldGroup.appendChild(helpText);
        }
        
        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã‚¨ãƒªã‚¢
        const errorMsg = document.createElement('div');
        errorMsg.className = 'error-message';
        errorMsg.id = `error-${field.fieldId}`;
        fieldGroup.appendChild(errorMsg);
        
        container.appendChild(fieldGroup);
      });
      
      updateNextButton();
    }
    
    // ãƒ†ã‚­ã‚¹ãƒˆãƒ»æ•°å€¤å…¥åŠ›
    function createTextOrNumberInput(field) {
      const input = document.createElement('input');
      input.type = field.fieldType;
      input.id = field.fieldId;
      input.name = field.fieldId;
      input.className = 'input-field';
      input.placeholder = field.placeholder || '';
      
      // ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å€¤ãŒã‚ã‚Œã°è¨­å®š
      const savedValue = inputManager.getInput(field.fieldId);
      if (savedValue !== undefined && savedValue !== null) {
        input.value = savedValue;
      }
      
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      input.addEventListener('input', (e) => {
        inputManager.setInput(field.fieldId, e.target.value);
        validateField(field);
        
        // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆtextã®å ´åˆï¼‰
        if (field.fieldType === 'text' && field.validation?.maxLength) {
          updateCharCounter(field, e.target.value);
        }
        
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¿å­˜
        saveToSession();
      });
      
      input.addEventListener('blur', () => {
        validateField(field);
      });
      
      const wrapper = document.createElement('div');
      wrapper.appendChild(input);
      
      // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
      if (field.fieldType === 'text' && field.validation?.maxLength) {
        const counter = document.createElement('div');
        counter.className = 'char-counter';
        counter.id = `counter-${field.fieldId}`;
        counter.textContent = `0 / ${field.validation.maxLength}`;
        wrapper.appendChild(counter);
      }
      
      return wrapper;
    }
    
    // ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢å…¥åŠ›
    function createTextareaInput(field) {
      const textarea = document.createElement('textarea');
      textarea.id = field.fieldId;
      textarea.name = field.fieldId;
      textarea.className = 'input-field';
      textarea.placeholder = field.placeholder || '';
      
      const savedValue = inputManager.getInput(field.fieldId);
      if (savedValue !== undefined && savedValue !== null) {
        textarea.value = savedValue;
      }
      
      textarea.addEventListener('input', (e) => {
        inputManager.setInput(field.fieldId, e.target.value);
        validateField(field);
        updateCharCounter(field, e.target.value);
        saveToSession();
      });
      
      textarea.addEventListener('blur', () => {
        validateField(field);
      });
      
      const wrapper = document.createElement('div');
      wrapper.appendChild(textarea);
      
      // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
      if (field.validation?.maxLength || field.validation?.minLength) {
        const counter = document.createElement('div');
        counter.className = 'char-counter';
        counter.id = `counter-${field.fieldId}`;
        const min = field.validation?.minLength || 0;
        const max = field.validation?.maxLength || 'âˆ';
        counter.textContent = `0 / ${min}ã€œ${max}`;
        wrapper.appendChild(counter);
      }
      
      return wrapper;
    }
    
    // ã‚»ãƒ¬ã‚¯ãƒˆå…¥åŠ›
    function createSelectInput(field) {
      const select = document.createElement('select');
      select.id = field.fieldId;
      select.name = field.fieldId;
      select.className = 'input-field';
      
      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚ªãƒ—ã‚·ãƒ§ãƒ³
      const defaultOption = document.createElement('option');
      defaultOption.value = '';
      defaultOption.textContent = 'é¸æŠã—ã¦ãã ã•ã„';
      select.appendChild(defaultOption);
      
      // ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ 
      field.options.forEach(option => {
        const opt = document.createElement('option');
        opt.value = option.value;
        opt.textContent = option.label;
        select.appendChild(opt);
      });
      
      // ä¿å­˜ã•ã‚Œã¦ã„ã‚‹å€¤ãŒã‚ã‚Œã°è¨­å®š
      const savedValue = inputManager.getInput(field.fieldId);
      if (savedValue) {
        select.value = savedValue;
      } else if (field.defaultValue) {
        select.value = field.defaultValue;
        inputManager.setInput(field.fieldId, field.defaultValue);
      }
      
      select.addEventListener('change', (e) => {
        inputManager.setInput(field.fieldId, e.target.value);
        validateField(field);
        saveToSession();
      });
      
      return select;
    }
    
    // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å…¥åŠ›
    function createCheckboxInput(field) {
      const container = document.createElement('div');
      container.className = 'checkbox-group';
      
      const savedValue = inputManager.getInput(field.fieldId) || [];
      
      field.options.forEach(option => {
        const item = document.createElement('div');
        item.className = 'checkbox-item';
        
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.id = `${field.fieldId}-${option.value}`;
        checkbox.name = field.fieldId;
        checkbox.value = option.value;
        
        if (Array.isArray(savedValue) && savedValue.includes(option.value)) {
          checkbox.checked = true;
        }
        
        checkbox.addEventListener('change', () => {
          updateCheckboxValue(field.fieldId);
          validateField(field);
          saveToSession();
        });
        
        const label = document.createElement('label');
        label.htmlFor = checkbox.id;
        label.textContent = option.label;
        
        item.appendChild(checkbox);
        item.appendChild(label);
        container.appendChild(item);
      });
      
      return container;
    }
    
    // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å€¤æ›´æ–°
    function updateCheckboxValue(fieldId) {
      const checkboxes = document.querySelectorAll(`input[name="${fieldId}"]:checked`);
      const values = Array.from(checkboxes).map(cb => cb.value);
      inputManager.setInput(fieldId, values);
    }
    
    // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³å…¥åŠ›
    function createRadioInput(field) {
      const container = document.createElement('div');
      container.className = 'radio-group';
      
      const savedValue = inputManager.getInput(field.fieldId);
      
      field.options.forEach(option => {
        const item = document.createElement('div');
        item.className = 'radio-item';
        
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.id = `${field.fieldId}-${option.value}`;
        radio.name = field.fieldId;
        radio.value = option.value;
        
        if (savedValue === option.value) {
          radio.checked = true;
        }
        
        radio.addEventListener('change', (e) => {
          inputManager.setInput(field.fieldId, e.target.value);
          validateField(field);
          saveToSession();
        });
        
        const label = document.createElement('label');
        label.htmlFor = radio.id;
        label.textContent = option.label;
        
        item.appendChild(radio);
        item.appendChild(label);
        container.appendChild(item);
      });
      
      return container;
    }
    
    // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    function validateField(field) {
      const errorElement = document.getElementById(`error-${field.fieldId}`);
      const inputElement = document.getElementById(field.fieldId);
      
      const result = inputManager.validate();
      const fieldError = inputManager.getError(field.fieldId);
      
      if (fieldError) {
        errorElement.textContent = fieldError;
        errorElement.classList.add('show');
        if (inputElement) {
          inputElement.classList.add('error');
        }
      } else {
        errorElement.classList.remove('show');
        if (inputElement) {
          inputElement.classList.remove('error');
        }
      }
      
      updateNextButton();
    }
    
    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼æ›´æ–°
    function updateCharCounter(field, value) {
      const counter = document.getElementById(`counter-${field.fieldId}`);
      if (!counter) return;
      
      const length = value ? value.length : 0;
      const maxLength = field.validation?.maxLength;
      const minLength = field.validation?.minLength;
      
      if (maxLength) {
        counter.textContent = `${length} / ${minLength || 0}ã€œ${maxLength}`;
        
        if (length > maxLength) {
          counter.classList.add('error');
          counter.classList.remove('warning');
        } else if (maxLength - length <= 20) {
          counter.classList.add('warning');
          counter.classList.remove('error');
        } else {
          counter.classList.remove('warning', 'error');
        }
      }
    }
    
    // æ¬¡ã¸ãƒœã‚¿ãƒ³ã®æœ‰åŠ¹/ç„¡åŠ¹
    function updateNextButton() {
      const result = inputManager.validate();
      document.getElementById('nextButton').disabled = !result.valid;
    }
    
    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ä¿å­˜
    function saveToSession() {
      const inputData = inputManager.toJSON();
      sessionStorage.setItem('user_inputs', JSON.stringify(inputData));
    }
    
    // ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
    function clearForm() {
      if (confirm('å…¥åŠ›å†…å®¹ã‚’ã™ã¹ã¦ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿ')) {
        inputManager.clearAll();
        sessionStorage.removeItem('user_inputs');
        renderInputFields();
      }
    }
    
    // æˆ»ã‚‹
    function goBack() {
      if (confirm('å…¥åŠ›å†…å®¹ã¯ä¿å­˜ã•ã‚Œã¾ã™ã€‚ã‚«ãƒ¼ãƒ‰é¸æŠã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ')) {
        const gameId = gameData.gameId.replace('-promotion', '');
        window.location.href = `/card-selection.html?id=${gameId}`;
      }
    }
    
    // æ¬¡ã¸é€²ã‚€
    function goToNext() {
      const result = inputManager.validate();
      
      if (!result.valid) {
        alert('å…¥åŠ›å†…å®¹ã«èª¤ã‚ŠãŒã‚ã‚Šã¾ã™ã€‚\nã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        
        // æœ€åˆã®ã‚¨ãƒ©ãƒ¼ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        if (result.errors.length > 0) {
          const firstError = result.errors[0];
          const element = document.getElementById(`group-${firstError.fieldId}`);
          if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
        
        return;
      }
      
      // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
      saveToSession();
      
      // æˆæœç‰©ç”Ÿæˆç”»é¢ã¸é·ç§»
      window.location.href = '/output.html';
    }
    
    function logout() {
      if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
        sessionStorage.clear();
        window.location.href = '/access-key.html';
      }
    }
  </script>
</body>
</html>
