<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼å…¥åŠ› - ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ </title>
  <link rel="stylesheet" href="/css/common.css">
</head>
<body>
  <div class="container">
    <div class="card card-small">
      <h1>ğŸ”‘ ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼å…¥åŠ›</h1>
      <p class="subtitle">
        ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯AIæ©Ÿèƒ½ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚<br>
        ç ”ä¿®æ‹…å½“è€…ã‹ã‚‰å—ã‘å–ã£ãŸã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
      </p>
      
      <form id="accessKeyForm">
        <div class="form-group">
          <input
            type="text"
            id="accessKey"
            name="accessKey"
            placeholder="demo-key-2024"
            required
            autocomplete="off"
            style="text-align: center; font-family: monospace; letter-spacing: 1px;"
          >
          <small style="display: block; margin-top: 8px; color: #666; text-align: center;">
            ä¾‹: demo-key-2024 ã¾ãŸã¯ ABCD-1234-EFGH-5678
          </small>
        </div>
        
        <div id="errorMessage" class="error-message" style="display: none;"></div>
        
        <button type="submit" class="btn" style="width: 100%;">
          é–‹å§‹
        </button>
      </form>
      
      <p style="margin-top: 30px; color: #999; font-size: 14px; text-align: center;">
        â€» ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ãŒãªã„å ´åˆã¯ã€ç ”ä¿®æ‹…å½“è€…ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„
      </p>
      
      <div style="margin-top: 20px; text-align: center;">
        <a href="/" style="color: #667eea; text-decoration: none;">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
      </div>
    </div>
  </div>
  
  <!-- AuthManager.js ã‚’èª­ã¿è¾¼ã¿ -->
  <script src="/js/core/AuthManager.js"></script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('accessKeyForm');
      const accessKeyInput = document.getElementById('accessKey');
      const errorMessage = document.getElementById('errorMessage');
      
      // AuthManagerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
      const authManager = new AuthManager();
      
      // ã™ã§ã«èªè¨¼æ¸ˆã¿ã®å ´åˆã€ã‚²ãƒ¼ãƒ é¸æŠç”»é¢ã¸
      if (authManager.isAuthenticated()) {
        console.log('æ—¢ã«èªè¨¼æ¸ˆã¿ã§ã™ã€‚ã‚²ãƒ¼ãƒ é¸æŠç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚');
        window.location.href = '/game-selection.html';
        return;
      }
      
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        const accessKey = accessKeyInput.value.trim();
        
        // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
        showLoading();
        
        try {
          // AuthManagerçµŒç”±ã§èªè¨¼
          await authManager.validateAccessKey(accessKey);
          
          console.log('èªè¨¼æˆåŠŸï¼ã‚²ãƒ¼ãƒ é¸æŠç”»é¢ã¸é·ç§»ã—ã¾ã™ã€‚');
          
          // ã‚²ãƒ¼ãƒ é¸æŠç”»é¢ã¸
          window.location.href = '/game-selection.html';
          
        } catch (error) {
          console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', error);
          showError(error.message);
          hideLoading();
        }
      });
      
      function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
      }
      
      function showLoading() {
        const button = form.querySelector('button[type="submit"]');
        button.disabled = true;
        button.textContent = 'èªè¨¼ä¸­...';
        errorMessage.style.display = 'none';
      }
      
      function hideLoading() {
        const button = form.querySelector('button[type="submit"]');
        button.disabled = false;
        button.textContent = 'é–‹å§‹';
      }
    });
  </script>
</body>
</html>
