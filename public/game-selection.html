<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚²ãƒ¼ãƒ é¸æŠ - ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ </title>
  <link rel="stylesheet" href="/css/common.css">
  <link rel="stylesheet" href="/css/senior.css">
</head>
<body>
  <!-- APIåˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒï¼ˆé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨ï¼‰ -->
  <div id="apiModeSwitch" style="position: fixed; top: 10px; right: 10px; background: white; padding: 12px; border: 2px solid #ccc; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); z-index: 9999; min-width: 200px;">
    <div style="margin-bottom: 8px; font-weight: bold; font-size: 14px; color: #333;">
      API ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ
    </div>
    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 8px; background: #f5f5f5; border-radius: 4px;">
      <input type="checkbox" id="apiModeCheckbox" onchange="toggleAPIMode(this)" style="width: 18px; height: 18px; cursor: pointer;">
      <div style="flex: 1;">
        <div id="apiModeLabel" style="font-weight: bold; font-size: 14px;">ğŸ¤– ãƒ¢ãƒƒã‚¯API</div>
        <div id="apiModeDescription" style="font-size: 11px; color: #666; margin-top: 2px;">ç„¡æ–™ãƒ»ãƒ†ã‚¹ãƒˆç”¨</div>
      </div>
    </label>
    <div id="apiWarning" style="display: none; margin-top: 8px; padding: 8px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; font-size: 11px; color: #856404;">
      âš ï¸ æœ¬ç•ªAPIã¯èª²é‡‘ã•ã‚Œã¾ã™<br>
      ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã¯å¿…ãšOFFã«
    </div>
  </div>

  <div class="container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
      <h1>ğŸ´ ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ </h1>
      <div class="header-nav">
        <span class="status">èªè¨¼æ¸ˆã¿</span>
        <button onclick="logout()" class="btn btn-secondary" style="padding: 8px 20px; font-size: 14px;">
          ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        </button>
      </div>
    </div>
    
    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="card">
      <h1>ã‚²ãƒ¼ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„</h1>
      <p class="subtitle">
        å®Ÿæ–½ã—ãŸã„ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã‚’é¸æŠã—ã¦ãã ã•ã„
      </p>
      
      <!-- ã‚²ãƒ¼ãƒ ä¸€è¦§ -->
      <div class="grid">
        <!-- ã‚²ãƒ¼ãƒ 1: è‡ªæ²»ä½“DXæ¨é€² -->
        <div class="grid-item" onclick="selectGame('city-dx')">
          <h2>ğŸ™ï¸ è‡ªæ²»ä½“DXæ¨é€²</h2>
          <p style="color: #666; margin-bottom: 15px;">
            äººå£30ä¸‡äººè¦æ¨¡ã®åœ°æ–¹ä¸­æ ¸å¸‚ã‚’ãƒ¢ãƒ‡ãƒ«ã«ã€ã‚¹ãƒãƒ¼ãƒˆã‚·ãƒ†ã‚£æ§‹æƒ³ã‚’ç«‹æ¡ˆ
          </p>
          <div style="background: #f0f0f0; padding: 10px; border-radius: 8px; font-size: 14px;">
            <strong>å¯¾è±¡:</strong> è‡ªæ²»ä½“è·å“¡ã€åœ°åŸŸæ´»æ€§åŒ–æ‹…å½“è€…<br>
            <strong>æ‰€è¦æ™‚é–“:</strong> 2-3æ™‚é–“<br>
            <strong>é›£æ˜“åº¦:</strong> â˜…â˜…â˜…â˜†â˜†
          </div>
        </div>
        
        <!-- ã‚²ãƒ¼ãƒ 2: ãƒ­ãƒœãƒƒãƒˆã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³å‰µå‡º -->
        <div class="grid-item" onclick="selectGame('robot-solution')">
          <h2>ğŸ¤– ãƒ­ãƒœãƒƒãƒˆã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³å‰µå‡º</h2>
          <p style="color: #666; margin-bottom: 15px;">
            ãƒ­ãƒœãƒƒãƒˆé–‹ç™ºä¼æ¥­ã®è¦–ç‚¹ã§ã€é¡§å®¢èª²é¡Œã«å¯¾ã™ã‚‹æœ€é©ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ææ¡ˆ
          </p>
          <div style="background: #f0f0f0; padding: 10px; border-radius: 8px; font-size: 14px;">
            <strong>å¯¾è±¡:</strong> å­¦ç”Ÿã€ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã€èµ·æ¥­å®¶<br>
            <strong>æ‰€è¦æ™‚é–“:</strong> 2-3æ™‚é–“<br>
            <strong>é›£æ˜“åº¦:</strong> â˜…â˜…â˜…â˜…â˜†
          </div>
        </div>
        
        <!-- ã‚²ãƒ¼ãƒ 3: ITé‹ç”¨ã‚¨ã‚¯ã‚»ãƒ¬ãƒ³ã‚¹ -->
        <div class="grid-item" onclick="selectGame('it-operations-excellence')">
          <h2>ğŸ’» ITé‹ç”¨ã‚¨ã‚¯ã‚»ãƒ¬ãƒ³ã‚¹</h2>
          <p style="color: #666; margin-bottom: 15px;">
            BIGLOBEã€NEC Cloud IaaSã®äº‹ä¾‹ã§å­¦ã¶é‹ç”¨æ¨™æº–åŒ–
          </p>
          <div style="background: #f0f0f0; padding: 10px; border-radius: 8px; font-size: 14px;">
            <strong>å¯¾è±¡:</strong> ITé‹ç”¨æ‹…å½“è€…ã€ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼<br>
            <strong>æ‰€è¦æ™‚é–“:</strong> 2-3æ™‚é–“<br>
            <strong>é›£æ˜“åº¦:</strong> â˜…â˜…â˜…â˜†â˜†
          </div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ 4: ITã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³å‰µå‡º -->
        <div class="grid-item" onclick="selectGame('it-security-solution')">
          <h2>ğŸ” ITã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³å‰µå‡º</h2>
          <p style="color: #666; margin-bottom: 15px;">
            é«˜æ ¡ç”ŸãŒITã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®èª²é¡Œã«å¯¾ã™ã‚‹å®Ÿè·µçš„ãªã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¼ç”»
          </p>
          <div style="background: #f0f0f0; padding: 10px; border-radius: 8px; font-size: 14px;">
            <strong>å¯¾è±¡:</strong> é«˜æ ¡ç”Ÿã€æƒ…å ±ç³»å­¦ç”Ÿ<br>
            <strong>æ‰€è¦æ™‚é–“:</strong> 2-3æ™‚é–“<br>
            <strong>é›£æ˜“åº¦:</strong> â˜…â˜…â˜…â˜†â˜†
          </div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ 5: ã‚³ãƒ³ãƒ“ãƒ‹DXé©æ–° -->
        <div class="grid-item" onclick="selectGame('convenience-store-dx')">
          <h2>ğŸª ã‚³ãƒ³ãƒ“ãƒ‹DXé©æ–°</h2>
          <p style="color: #666; margin-bottom: 15px;">
            èº«è¿‘ãªã‚³ãƒ³ãƒ“ãƒ‹ã‚’é¡Œæã«ã€DXæŠ€è¡“ã§ãƒ“ã‚¸ãƒã‚¹é©æ–°ã‚’ææ¡ˆï¼ˆãƒˆãƒ©ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹: 52æšï¼‰
          </p>
          <div style="background: #f0f0f0; padding: 10px; border-radius: 8px; font-size: 14px;">
            <strong>å¯¾è±¡:</strong> ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³ã€DXæ¨é€²æ‹…å½“è€…<br>
            <strong>æ‰€è¦æ™‚é–“:</strong> 2-3æ™‚é–“<br>
            <strong>é›£æ˜“åº¦:</strong> â˜…â˜…â˜…â˜†â˜†
          </div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ 6: æºå¸¯ã‚­ãƒ£ãƒªã‚¢DXé©æ–° -->
        <div class="grid-item" onclick="selectGame('mobile-carrier-dx')">
          <h2>ğŸ“± æºå¸¯ã‚­ãƒ£ãƒªã‚¢DXé©æ–°</h2>
          <p style="color: #666; margin-bottom: 15px;">
            æºå¸¯é›»è©±äº‹æ¥­è€…ã‚’é¡Œæã«ã€åŠå°ä½“æŠ€è¡“ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ»ã‚µãƒ¼ãƒ“ã‚¹ã‚’é©æ–°ï¼ˆãƒˆãƒ©ãƒ³ãƒ—ãƒ™ãƒ¼ã‚¹: 52æšï¼‰
          </p>
          <div style="background: #f0f0f0; padding: 10px; border-radius: 8px; font-size: 14px;">
            <strong>å¯¾è±¡:</strong> åŠå°ä½“ãƒ»é›»å­å·¥å­¦ç³»å­¦ç”Ÿã€é€šä¿¡æ¥­ç•Œå¿—æœ›è€…<br>
            <strong>æ‰€è¦æ™‚é–“:</strong> 2-3æ™‚é–“<br>
            <strong>é›£æ˜“åº¦:</strong> â˜…â˜…â˜…â˜…â˜†
          </div>
        </div>

        <!-- ã‚²ãƒ¼ãƒ 7: ãŠãŸã™ã‘ã•ã‚“ -->
        <div class="grid-item" onclick="selectGame('otasuke-san')">
          <h2>ğŸŒ¸ ãŠãŸã™ã‘ã•ã‚“</h2>
          <p style="color: #666; margin-bottom: 15px;">
            æš®ã‚‰ã—ã®ãŠæ‰‹ä¼ã„ - 81æ­³ã®ãŠæ¯æ§˜ãŒä½¿ãˆã‚‹å„ªã—ã„AIæ”¯æ´ãƒ„ãƒ¼ãƒ«
          </p>
          <div style="background: #f0f0f0; padding: 10px; border-radius: 8px; font-size: 14px;">
            <strong>å¯¾è±¡:</strong> é«˜é½¢è€…ã€ã”å®¶æ—<br>
            <strong>æ‰€è¦æ™‚é–“:</strong> 10-15åˆ†<br>
            <strong>é›£æ˜“åº¦:</strong> â˜…â˜†â˜†â˜†â˜†
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ã‚³ã‚¢ã‚¯ãƒ©ã‚¹èª­ã¿è¾¼ã¿ -->
  <script src="/js/core/AuthManager.js"></script>
  <script src="/js/core/GameManager.js"></script>
  <script src="/js/core/StatsLogger.js"></script>

  <script>
    function toggleAPIMode(checkbox) {
      const label = document.getElementById('apiModeLabel');
      const description = document.getElementById('apiModeDescription');
      const warning = document.getElementById('apiWarning');

      if (checkbox.checked) {
        // æœ¬ç•ªAPI ON
        if (!confirm('æœ¬ç•ªAPIï¼ˆAnthropic Claudeï¼‰ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã‹ï¼Ÿ\n\nâš ï¸ èª²é‡‘ãŒç™ºç”Ÿã—ã¾ã™\nâš ï¸ 1å›ã®ç”Ÿæˆã§ç´„$0.05ã‹ã‹ã‚Šã¾ã™\n\nãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã¯å¿…ãšOFFã«ã—ã¦ãã ã•ã„ã€‚')) {
          checkbox.checked = false;
          return;
        }

        localStorage.setItem('use_mock_api', 'false');
        label.textContent = 'âœ¨ æœ¬ç•ªAPI';
        label.style.color = '#dc3545';
        description.textContent = 'èª²é‡‘ã‚ã‚Šãƒ»æœ¬ç•ªç’°å¢ƒ';
        description.style.color = '#dc3545';
        warning.style.display = 'block';

        // å…¨ä½“ã®è¦‹ãŸç›®ã‚’å¤‰æ›´
        document.getElementById('apiModeSwitch').style.borderColor = '#dc3545';
        document.getElementById('apiModeSwitch').style.background = '#fff5f5';

        console.warn('ğŸ”´ æœ¬ç•ªAPIæœ‰åŠ¹åŒ–ï¼šèª²é‡‘ãŒç™ºç”Ÿã—ã¾ã™');

      } else {
        // ãƒ¢ãƒƒã‚¯API ON
        localStorage.setItem('use_mock_api', 'true');
        label.textContent = 'ğŸ¤– ãƒ¢ãƒƒã‚¯API';
        label.style.color = '#28a745';
        description.textContent = 'ç„¡æ–™ãƒ»ãƒ†ã‚¹ãƒˆç”¨';
        description.style.color = '#666';
        warning.style.display = 'none';

        // å…ƒã®è¦‹ãŸç›®ã«æˆ»ã™
        document.getElementById('apiModeSwitch').style.borderColor = '#ccc';
        document.getElementById('apiModeSwitch').style.background = 'white';

        console.log('ğŸŸ¢ ãƒ¢ãƒƒã‚¯APIæœ‰åŠ¹åŒ–ï¼šç„¡æ–™ã§ä½¿ç”¨ã§ãã¾ã™');
      }
    }
  </script>

  <script>
    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
    const authManager = new AuthManager();
    const gameManager = new GameManager();
    
    // èªè¨¼ãƒã‚§ãƒƒã‚¯
    document.addEventListener('DOMContentLoaded', () => {
      // AuthManagerã§èªè¨¼çŠ¶æ…‹ã‚’ãƒã‚§ãƒƒã‚¯
      if (!authManager.isAuthenticated()) {
        console.log('æœªèªè¨¼ã®ãŸã‚ã€ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼å…¥åŠ›ç”»é¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™');
        authManager.requireAuth('/game-selection.html');
        return;
      }

      console.log('èªè¨¼æ¸ˆã¿ - ã‚»ãƒƒã‚·ãƒ§ãƒ³æ®‹ã‚Šæ™‚é–“:', authManager.getRemainingTime(), 'åˆ†');

      // APIåˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒã®çŠ¶æ…‹å¾©å…ƒ
      restoreAPIModeSwitch();

      // ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’äº‹å‰èª­ã¿è¾¼ã¿ï¼ˆå°†æ¥ã®å‹•çš„è¡¨ç¤ºç”¨ï¼‰
      initializeGames();
    });

    /**
     * APIåˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒã®çŠ¶æ…‹å¾©å…ƒ
     */
    function restoreAPIModeSwitch() {
      const useMock = localStorage.getItem('use_mock_api');
      const checkbox = document.getElementById('apiModeCheckbox');
      const label = document.getElementById('apiModeLabel');
      const description = document.getElementById('apiModeDescription');
      const warning = document.getElementById('apiWarning');

      // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ãƒ¢ãƒƒã‚¯ï¼ˆå®‰å…¨æ€§å„ªå…ˆï¼‰
      if (useMock === 'false') {
        checkbox.checked = true;
        label.textContent = 'âœ¨ æœ¬ç•ªAPI';
        label.style.color = '#dc3545';
        description.textContent = 'èª²é‡‘ã‚ã‚Šãƒ»æœ¬ç•ªç’°å¢ƒ';
        description.style.color = '#dc3545';
        warning.style.display = 'block';
        document.getElementById('apiModeSwitch').style.borderColor = '#dc3545';
        document.getElementById('apiModeSwitch').style.background = '#fff5f5';
        console.warn('ğŸ”´ æœ¬ç•ªAPIæœ‰åŠ¹ï¼ˆå‰å›ã®è¨­å®šã‚’å¾©å…ƒï¼‰');
      } else {
        // æ˜ç¤ºçš„ã«ãƒ¢ãƒƒã‚¯ã«è¨­å®š
        localStorage.setItem('use_mock_api', 'true');
        console.log('ğŸŸ¢ ãƒ¢ãƒƒã‚¯APIæœ‰åŠ¹ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰');
      }
    }
    
    /**
     * ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®åˆæœŸåŒ–
     */
    async function initializeGames() {
      try {
        const games = await gameManager.loadGames();
        console.log('ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ:', games);
        
        // å°†æ¥çš„ã«ã¯ã“ã“ã§ã‚²ãƒ¼ãƒ ä¸€è¦§ã‚’å‹•çš„ã«ç”Ÿæˆ
        // ç¾åœ¨ã¯é™çš„HTMLãªã®ã§ä½•ã‚‚ã—ãªã„
        
      } catch (error) {
        console.error('ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
        alert('ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
      }
    }
    
    /**
     * ã‚²ãƒ¼ãƒ ã‚’é¸æŠ
     */
    async function selectGame(gameId) {
      try {
        // GameManagerã§ã‚²ãƒ¼ãƒ ã‚’é¸æŠ
        const game = gameManager.selectGame(gameId);
        console.log('ã‚²ãƒ¼ãƒ ã‚’é¸æŠã—ã¾ã—ãŸ:', game);

        // çµ±è¨ˆè¨˜éŒ²ï¼ˆå®Œäº†ã‚’å¾…ã¤ï¼‰
        try {
          const accessKey = authManager.getSession();
          if (typeof StatsLogger !== 'undefined') {
            const statsLogger = new StatsLogger();
            await statsLogger.logGameSelection(gameId, accessKey);
            console.log('çµ±è¨ˆè¨˜éŒ²å®Œäº†');
          }
        } catch (statsError) {
          // çµ±è¨ˆè¨˜éŒ²å¤±æ•—ã¯ã‚²ãƒ¼ãƒ ç¶šè¡Œã«å½±éŸ¿ã—ãªã„
          console.warn('çµ±è¨ˆè¨˜éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ:', statsError);
        }

        // ã‚«ãƒ¼ãƒ‰é¸æŠç”»é¢ã¸é·ç§»
        window.location.href = `/card-selection.html?id=${gameId}`;

      } catch (error) {
        console.error('ã‚²ãƒ¼ãƒ é¸æŠã‚¨ãƒ©ãƒ¼:', error);
        alert('ã‚²ãƒ¼ãƒ ã®é¸æŠã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
      }
    }
    
    /**
     * ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
     */
    function logout() {
      if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
        // AuthManagerã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢
        authManager.clearSession();
        
        // GameManagerã®çŠ¶æ…‹ã‚‚ãƒªã‚»ãƒƒãƒˆ
        gameManager.reset();
        
        console.log('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
        window.location.href = '/access-key.html';
      }
    }
  </script>
</body>
</html>
