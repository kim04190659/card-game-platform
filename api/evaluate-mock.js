module.exports = async (req, res) => {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  // 少し待機して評価をシミュレート
  await new Promise(resolve => setTimeout(resolve, 1500));

  // リクエストからgameIdを取得
  const { gameId } = req.body;

  // gameIdに応じて異なる評価モックを返す
  let mockEvaluation;

  if (gameId === 'robot-solution') {
    // ロボットソリューション用モック評価
    mockEvaluation = {
      scores: {
        "技術的実現可能性": 88,
        "コスト競争力": 85,
        "市場ニーズとの適合": 90,
        "差別化ポイント": 82
      },
      reasons: {
        "技術的実現可能性": "AI画像認識と自律移動の技術は既に成熟しており、実現可能性が高い。パートナー企業との協業により技術リスクも低減されている。",
        "コスト競争力": "競合の500万円に対して300万円という価格設定は魅力的。既存システムとの統合によりコストを抑えている点が評価できる。",
        "市場ニーズとの適合": "介護施設の夜間見守り課題は深刻で、市場ニーズが明確。転倒・徘徊検知という具体的な機能が顧客課題に直結している。",
        "差別化ポイント": "自律移動による死角なしという点は差別化要素。ただし、競合も同様の機能を持つ可能性があり、さらなる独自性が求められる。"
      },
      improvements: [
        "AI画像認識の精度データ（誤検知率など）を具体的に示すとより説得力が増す",
        "プライバシー保護対策（映像データの管理方法）を明記すべき",
        "他の介護ロボット（移乗支援、食事支援など）との連携可能性を提案すると、将来性が高まる"
      ],
      overallScore: 87,
      feedback: "市場ニーズが明確で、技術的にも実現可能性の高い優れた提案です。特にコスト競争力と既存システムとの統合という視点が評価できます。プライバシー対策と精度データの明示により、さらに説得力が増すでしょう。（これはテスト用のモック評価です）"
    };
  } else {
    // デフォルト: 自治体DX用モック評価
    mockEvaluation = {
      scores: {
        "実現可能性": 85,
        "住民メリット": 90,
        "持続可能性": 85,
        "革新性": 88
      },
      reasons: {
        "実現可能性": "既存インフラとの統合により実現可能性が高い。予算規模も適切。",
        "住民メリット": "コミュニティバス連携により住民の利便性が大幅に向上。",
        "持続可能性": "地域住民との協働体制が整っており、長期運用が期待できる。",
        "革新性": "温泉観光資源との連携というユニークな視点が評価できる。"
      },
      improvements: [
        "データセキュリティ対策の明確化が必要",
        "段階的な展開計画の詳細化を推奨",
        "費用対効果の定量的な示し方を改善"
      ],
      overallScore: 87,
      feedback: "非常に実現可能性の高い、バランスの取れた提案です。特に既存リソースを活かす視点が優れています。（これはテスト用のモック評価です）"
    };
  }

  return res.status(200).json({
    success: true,
    content: JSON.stringify(mockEvaluation, null, 2)
  });
};
