export default async function handler(req, res) {
  if (req.method !== 'POST') {
    return res.status(405).json({ error: 'Method not allowed' });
  }

  const { gameId } = req.body;

  // ゲームIDに応じたモックデータ
  const mockOutputs = {
    'city-dx': `【概要】
人口30万人の地方中核市である霧島市において、既存インフラとの統合を活かした
実現可能性の高いスマートシティ構想を提案します。

【背景・課題】
霧島市は現在、行政DXの推進と住民サービス向上という2つの課題を抱えています。
特に、既存のコミュニティバスシステムの活用や、地域住民との協働体制が整って
いる強みを活かすことが重要です。

【提案内容】
1. スマートシティ基盤の構築
   - 既存コミュニティバスシステムとの統合
   - リアルタイム位置情報の活用
   - 予約システムの導入
   
2. AI活用による行政サービス向上
   - AIチャットボットによる24時間問い合わせ対応
   - 申請手続きのオンライン化
   
3. データ活用基盤
   - Microsoft 365を活用した情報共有基盤
   - Power BIによるデータ可視化

【実施計画】
期間: 2年間
予算: 5,000万円
- Phase 1（6ヶ月）: 基盤構築
- Phase 2（12ヶ月）: サービス展開
- Phase 3（6ヶ月）: 運用・改善

【期待効果】
- 住民の利便性向上: 移動手段の最適化により30%改善
- 行政コスト削減: 問い合わせ対応の自動化により20%削減
- 地域活性化: 温泉観光との連携により観光客10%増加`,

    'robot-solution': `【エグゼクティブサマリー】
物流業界における深刻な人手不足問題に対し、自律移動ロボット（AMR）技術を
活用したソリューションを提案します。

【市場分析】
物流業界では、EC市場の拡大により配送需要が年率10%で増加している一方、
ドライバー不足が深刻化しています。倉庫内作業の自動化ニーズは年々高まって
います。

【提案ソリューション】
1. AMRによる倉庫内搬送自動化
   - 最大積載量: 500kg
   - 自律走行による最適ルート選択
   - 既存の倉庫管理システム（WMS）との連携

2. 協働ロボットによるピッキング支援
   - 人とロボットの協働作業
   - AIによる最適作業割り当て

【技術的優位性】
- 独自開発のSLAM技術による高精度な自己位置推定
- 複数台の協調制御による効率的な動線計画
- 機械学習による継続的な性能向上

【実施計画】
開発期間: 18ヶ月
導入コスト: 初期投資 3,000万円 / 運用コスト 月額80万円

- Phase 1（6ヶ月）: プロトタイプ開発
- Phase 2（6ヶ月）: 実証実験
- Phase 3（6ヶ月）: 量産化

【投資対効果】
- 人件費削減: 年間1,500万円
- 生産性向上: 作業効率30%改善
- 投資回収期間: 2.5年

【ターゲット顧客】
- 大手物流企業（100社見込み）
- EC事業者の物流センター（200社見込み）
- 製造業の工場内物流（150社見込み）`,

    'it-operations-excellence': `【IT運用改善提案書】

【エグゼクティブサマリー】
現在の運用体制における課題を分析し、ITIL/SIAMの国際標準フレームワークを活用した
実現可能性の高い運用改善計画を提案します。本提案により、運用品質の向上とコスト削減を
同時に実現します。

【現状分析】
■ 強み
- チームメンバーのスキルセット: 技術的基盤がある
- 改善への意欲: 課題認識と改善意識が高い
- 予算確保: 改善のための投資が可能

■ 課題
選択されたカードから、以下の課題が明確になりました：
- 運用プロセスの属人化と標準化不足
- 監視体制の不備による障害対応の遅延
- 変更管理・構成管理の未整備
- ドキュメント・ナレッジの体系化不足

【提案する改善策】

1. ITIL/ITSMプロセスの導入
   ■ 実施内容
   - インシデント管理プロセスの確立
   - 変更管理プロセスの標準化
   - 構成管理データベース（CMDB）の構築
   - サービスレベル管理（SLM）の実装
   
   ■ 期待効果
   - インシデント対応時間: 50%短縮
   - 変更作業起因の障害: 70%削減
   - SLA達成率: 95%→99%向上

2. 統合監視基盤の構築
   ■ 実施内容
   - 監視の5つの視点での体系化
     * 主体: 誰が監視するか
     * 対象: 何を監視するか
     * タイミング: いつ監視するか
     * しきい値: どの基準で判断するか
     * 即時対応性: どう対応するか
   - Datadog/Splunk等の統合監視ツール導入
   - ログ収集・分析基盤の整備
   - ダッシュボードによる可視化
   
   ■ 期待効果
   - 障害検知時間: 60%短縮
   - 誤検知: 80%削減
   - 監視カバレッジ: 70%→95%向上

3. 運用のホワイトボックス化
   ■ 実施内容
   - 運用手順書の体系的整備（50本作成）
   - ナレッジベース構築（Confluence等）
   - 暗黙知の形式知化（ベテラン知見の文書化）
   - 検索可能なナレッジ管理基盤
   
   ■ 期待効果
   - 新人育成期間: 40%短縮
   - ナレッジ検索時間: 70%短縮
   - 対応の標準化率: 50%→90%向上

4. 運用自動化の推進
   ■ 実施内容
   - 定型作業のRPA化（20業務）
   - Infrastructure as Code（IaC）導入
   - CI/CDパイプライン構築
   - 自動復旧スクリプトの実装
   
   ■ 期待効果
   - 手作業時間: 50%削減
   - 人的ミス: 80%削減
   - 運用コスト: 年間20%削減

【実施計画】

■ Phase 1: 基盤整備（1-3ヶ月）
- 現状詳細分析とギャップ分析
- ITILプロセス設計
- ツール選定と調達
- 体制設計とロール定義

■ Phase 2: 実装（4-9ヶ月）
- ITSMツール（ServiceNow等）導入・設定
- 統合監視基盤構築
- CMDB構築と資産情報登録
- 運用手順書作成（優先度高い業務から）
- 自動化スクリプト開発

■ Phase 3: 定着化（10-12ヶ月）
- 運用チームへのトレーニング（全3回）
- パイロット運用（2ヶ月）
- 本番移行
- 運用KPIモニタリング開始
- 継続改善サイクル確立

【投資計画】

■ 初期投資: 予算範囲内で最適化
- ITSMツールライセンス: 20%
- 統合監視ツール: 25%
- 開発・カスタマイズ: 30%
- トレーニング・コンサル: 15%
- 予備費: 10%

■ 運用コスト（年間）
- ツールライセンス維持費
- 外部サポート費用
- 継続改善活動費

【投資対効果（ROI）】

■ 削減効果（年間）
- 運用人件費削減: 20%
- 障害対応コスト削減: 30%
- 手作業削減による効率化: 年間1,200時間

■ 投資回収期間
- 1.5-2年で投資回収見込み

■ 定性効果
- サービス品質向上によるユーザー満足度向上
- 運用チームの負荷軽減とモチベーション向上
- 属人化解消による運用リスク低減
- ナレッジ蓄積による組織力向上

【リスクと対策】

■ リスク1: 現場の抵抗
対策: 段階的導入、早期成功事例の創出、十分なトレーニング

■ リスク2: ツール定着不足
対策: チャンピオン制度、定期的なフォローアップ、使いやすいUI設計

■ リスク3: スキル不足
対策: 外部コンサル活用、資格取得支援、ペアワーク推進

【成功の鍵】

1. 経営層のコミットメント
2. 段階的アプローチ（Quick Wins + 中長期施策）
3. 現場を巻き込んだ改善活動
4. 継続的な改善サイクル（PDCA）
5. エクセレントサービスへのこだわり

【結論】

本提案は、木村好孝の35年にわたるIT運用経験とBIGLOBE、NEC Cloud IaaSでの
実践知見に基づいた、実現可能性の高い改善計画です。ITIL/SIAMの国際標準を
活用しながら、運用のホワイトボックス化を推進することで、持続的な運用品質向上と
コスト削減を実現します。

【参考: BIGLOBEでの実践例】
- 年間1万件のインシデント対応プロセス確立
- BRM（構成管理システム）による数千台規模の構成管理
- 監視の5つの視点による体系的監視設計
- 変更管理の徹底（全作業の事前登録・監視員による全体把握）
- 運用の標準化により、新人でも2ヶ月で独り立ち可能な体制構築`
  };

  const output = mockOutputs[gameId] || mockOutputs['city-dx'];

  return res.status(200).json({
    content: output,
    mockMode: true,
    timestamp: new Date().toISOString()
  });
}
